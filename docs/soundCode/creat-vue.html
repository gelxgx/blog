<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>
      ã€æºç è®¡åˆ’ç¬¬å…«æœŸã€‘create-vue | ç˜¦è™
    </title>
    <meta name="description" content="A VitePress site">
    <link rel="stylesheet" href="/blog/_assets/style.822f840d.css">
    <link rel="modulepreload" href="/blog/_assets/common-1984dd55.js">
    <link rel="modulepreload" href="/blog/_assets/docs_soundCode_creat-vue.md.782b5c9a.lean.js">
    <link rel="modulepreload" href="/blog/_assets/app.9e239910.js">
    <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no">
    <meta name="keywords" content="ç˜¦è™">
    <link rel="icon" href="/favicon.ico">
    <link rel="stylesheet" href="https://lib.baomitu.com/gitalk/1.7.0/gitalk.min.css">
    <script src="https://lib.baomitu.com/gitalk/1.7.0/gitalk.min.js"></script>
    <script src="https://lib.baomitu.com/axios/0.21.1/axios.js"></script>
    
  </head>
  <body>
    <div id="app"><!--[--><div id="containerColor" class="no-sidebar theme" data-v-1eb0b654><header class="navbar" data-v-1eb0b654><!--[--><a class="title" aria-label="ç˜¦è™, back to home" href="/blog/"><img class="logo" src="/blog/favicon.ico" alt="logo"><span>ç˜¦è™</span></a><div class="flex-grow"></div><nav class="nav-links hide-mobile"><!--[--><!--[--><div class="nav-item"><a class="nav-link" href="/blog/index.html" target="" rel="">ğŸ  é¦–é¡µ<!-- <OutboundLink v-if="isExternalLink" /> --></a></div><!--]--><!--[--><div class="nav-item"><a class="nav-link" href="/blog/more/docs.html" target="" rel="">ğŸ“… å½’æ¡£<!-- <OutboundLink v-if="isExternalLink" /> --></a></div><!--]--><!--[--><div class="nav-item"><a class="nav-link" href="/blog/more/tags.html" target="" rel="">ğŸ“‚ åˆ†ç±»<!-- <OutboundLink v-if="isExternalLink" /> --></a></div><!--]--><!--[--><div class="nav-item"><a class="nav-link" href="/blog/more/Friendship.html" target="" rel="">ğŸ‘« å‹æƒ…é“¾æ¥<!-- <OutboundLink v-if="isExternalLink" /> --></a></div><!--]--><!--]--><!----><!----></nav><!--[--><!--]--><!--]--><div class="sidebar-button" data-v-1eb0b654><svg class="icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z" class></path></svg></div></header><aside class="" data-v-1eb0b654><!--[--><nav class="nav-links show-mobile"><!--[--><!--[--><div class="nav-item"><a class="nav-link" href="/blog/index.html" target="" rel="">ğŸ  é¦–é¡µ<!-- <OutboundLink v-if="isExternalLink" /> --></a></div><!--]--><!--[--><div class="nav-item"><a class="nav-link" href="/blog/more/docs.html" target="" rel="">ğŸ“… å½’æ¡£<!-- <OutboundLink v-if="isExternalLink" /> --></a></div><!--]--><!--[--><div class="nav-item"><a class="nav-link" href="/blog/more/tags.html" target="" rel="">ğŸ“‚ åˆ†ç±»<!-- <OutboundLink v-if="isExternalLink" /> --></a></div><!--]--><!--[--><div class="nav-item"><a class="nav-link" href="/blog/more/Friendship.html" target="" rel="">ğŸ‘« å‹æƒ…é“¾æ¥<!-- <OutboundLink v-if="isExternalLink" /> --></a></div><!--]--><!--]--><!----><!----></nav><!--[--><!--]--><ul class="sidebar"><!--[--><!--]--></ul><!--[--><!--]--><!--]--></aside><!----><!-- TODO: make this button accessible --><div class="sidebar-mask" data-v-1eb0b654></div><main data-v-1eb0b654><!--[--><div class="content"><!--[--><!--]--><div class="md-header"><div class="md-title">ã€æºç è®¡åˆ’ç¬¬å…«æœŸã€‘create-vue</div><span id="jinrishici-sentence">æ­£åœ¨åŠ è½½ä»Šæ—¥è¯—è¯....</span><div class="md-date">2021-12-01</div></div><ul class="catalog"><!--[--><li class="catalog-item"><!----><a class="level level-3" href="#_1-é˜…è¯»å‰å‡†å¤‡">1. é˜…è¯»å‰å‡†å¤‡</a></li><li class="catalog-item"><!----><a class="level level-3" href="#_2-ä½¿ç”¨å®ƒ">2. ä½¿ç”¨å®ƒ</a></li><li class="catalog-item"><!----><a class="level level-3" href="#_3-é˜…è¯»æºç ">3. é˜…è¯»æºç </a></li><li class="catalog-item"><!----><a class="level level-3" href="#_4-æ€»ç»“">4. æ€»ç»“</a></li><!--]--></ul><div><blockquote><p>ç»§ç»­è·Ÿä¸Šå·å“¥ä¸¾åŠçš„é˜…è¯»æºç æ´»åŠ¨~</p><p>æ˜é‡‘åŸæ–‡ï¼š<a href="https://juejin.cn/post/7018344866811740173#heading-4" target="_blank" rel="noopener noreferrer">https://juejin.cn/post/7018344866811740173#heading-4</a></p></blockquote><h3 id="_1-é˜…è¯»å‰å‡†å¤‡"><a class="header-anchor" href="#_1-é˜…è¯»å‰å‡†å¤‡" aria-hidden="true">#</a> 1. é˜…è¯»å‰å‡†å¤‡</h3><p>è¿™æ˜¯ä¸€ä¸ªvite+vue3çš„è„šæ‰‹æ¶ï¼Œç›®å‰è¿˜å±äºæ¯”è¾ƒåˆç‰ˆçš„çŠ¶æ€ï¼ŒREADMEä¹Ÿä¸æ˜¯å¾ˆå…¨é¢ï¼Œå¤§è‡´æµè§ˆæºç åï¼Œä¸»è¦æœ‰ä»¥ä¸‹å‡ ç‚¹å¯ä»¥å¥½å¥½å­¦ä¹ ä¸‹ï¼š</p><ul><li>npm init</li><li>äº¤äº’å¼åˆå§‹åŒ–</li></ul><!----><ul><li>æ ¹æ®é€‰æ‹©é…ç½®ç”Ÿæˆä¸åŒæ¨¡æ¿</li><li>æ¨¡æ¿ç”ŸæˆåŸç†</li></ul><p>é¡¹ç›®åœ°å€ï¼š <a href="https://github.com/vuejs/create-vue" target="_blank" rel="noopener noreferrer">https://github.com/vuejs/create-vue</a></p><p>è¿™æ˜¯ä¸€ä¸ªæˆ‘ä¹‹å‰å®Œå…¨æ²¡æœ‰æ¥è§¦è¿‡çš„é¡¹ç›®ï¼Œæ–‡ç« ä¸­é—´ä¼šæ‹“å±•å¾ˆå¤š<code>create-Vue</code>ä¹‹å¤–çš„å†…å®¹ï¼Œæœ€ç»ˆå¸Œæœ›è‡ªå·±å¯ä»¥é€šè¿‡é˜…è¯»æºç ï¼Œäº§å‡ºcliå·¥å…·ï¼Œæ–¹ä¾¿åœ¨å·¥ä½œä¸­é¡¹ç›®å¼€å‘</p><h3 id="_2-ä½¿ç”¨å®ƒ"><a class="header-anchor" href="#_2-ä½¿ç”¨å®ƒ" aria-hidden="true">#</a> 2. ä½¿ç”¨å®ƒ</h3><p>ä½¿ç”¨èµ·æ¥éå¸¸ç®€å•ï¼Œåªéœ€è¦ npm init å³å¯</p><div class="language-"><pre><code>npm init vue@next
</code></pre></div><p>æ¥ç€è¾“å…¥é¡¹ç›®åã€ç¡®è®¤æ˜¯å¦éœ€è¦é¢å¤–çš„é…ç½®é¡¹ï¼Œå³å¯ç”Ÿæˆä¸€ä¸ªå®Œæ•´çš„é¡¹ç›®</p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/f538e0ebb2f745f99bd6f4c1383f3dd2~tplv-k3u1fbpfcp-zoom-1.image" alt=""></p><p>æœ€ç»ˆåªéœ€è¦<code>cd vue-project</code>ã€<code>npm install</code>ã€<code>npm run dev</code>å³å¯éå¸¸æ€¥é€Ÿçš„æ‰“å¼€è¿™ä¸ªé¡¹ç›®</p><h3 id="_3-é˜…è¯»æºç "><a class="header-anchor" href="#_3-é˜…è¯»æºç " aria-hidden="true">#</a> 3. é˜…è¯»æºç </h3><p>é¦–å…ˆå…‹éš†é¡¹ç›®ã€å®‰è£…ä¾èµ–</p><div class="language-"><pre><code>git clone https://github.com/vuejs/create-vue.git
npm install
</code></pre></div><p>è¿›å…¥package.jsonçœ‹çœ‹å¯æ‰§è¡Œçš„è„šæœ¬</p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/75bebe4d2d9b431a9111abfd77fa19fa~tplv-k3u1fbpfcp-zoom-1.image" alt=""></p><p>çœ‹åˆ°å‡ ä¸ªç†Ÿæ‚‰çš„è„šæœ¬ï¼š</p><ul><li>build:å°†è„šæ‰‹æ¶ä¸»æ–‡ä»¶index.jsæ‰“åŒ…è¾“å‡ºæˆoutfile.cjs</li><li>test:æ‰§è¡Œæµ‹è¯•ç”¨ä¾‹</li></ul><p>å…ˆä»æ‰§è¡Œtestè°ƒè¯•èµ·ï¼</p><h4 id="_3-1-snapshot"><a class="header-anchor" href="#_3-1-snapshot" aria-hidden="true">#</a> 3.1 snapshot</h4><p>æ‰§è¡Œ<code>npm run test</code>æ—¶ï¼Œä¼šå…ˆæ‰§è¡Œ<code>npm run pretest</code> ï¼ˆç¬¬ä¸‰æœŸçš„çŸ¥è¯†ç‚¹ï¼šnpmé’©å­å‡½æ•°ï¼‰</p><p>çœ‹çœ‹snapshotä¸­éƒ½åšäº†ä»€ä¹ˆäº‹æƒ…~</p><p>è¿›å…¥snapshotå‘ç°è¿™é‡Œåšäº†ä¸¤ä»¶äº‹ï¼š</p><ul><li>è°ƒç”¨nodeçš„å­è¿›ç¨‹æ–¹æ³•ä¸­åŒæ­¥è¿›ç¨‹å‡½æ•°ï¼Œæ ¹æ®index.jsæ–‡ä»¶ä¸­çš„è§„åˆ™ï¼Œåœ¨playgroundæ–‡ä»¶å¤¹ä¸‹åˆ›å»ºä¸åŒçš„æ¨¡æ¿ï¼Œæ–¹ä¾¿è°ƒç”¨test.jsè¿›è¡Œæµ‹è¯•</li><li>æ ¹æ®äº”ç§æ‹“å±•å±æ€§ï¼Œè¿›è¡ŒäºŒè¿›åˆ¶çš„æ’åˆ—ç»„åˆï¼Œæœ€ç»ˆä¼šç”Ÿæˆ31ç§+defaultä¸€å…±32ç§ç»„åˆ</li></ul><p>è¿™é‡Œä¸»è¦çœ‹ä¸€ä¸‹ç”Ÿæˆæ¨¡æ¿çš„æ–¹æ³•ï¼š</p><div class="language-"><pre><code>// è·å–åŸºæœ¬è·¯å¾„
const __dirname = path
  .dirname(new URL(import.meta.url).pathname)
  .substring(process.platform === &#39;win32&#39; ? 1 : 0)


// è¿™é‡Œçš„binæ˜¯æ‰§è¡Œæ‰“åŒ…åçš„index.jsæ–‡ä»¶ç”Ÿæˆé¡¹ç›®æ¨¡æ¿ï¼Œæ–¹ä¾¿è°ƒè¯•å°±æ”¹æˆäº†index.js
// const bin = path.resolve(__dirname, &#39;./outfile.cjs&#39;)
const bin = path.resolve(__dirname, &#39;./index.js&#39;)
// ç›®æ ‡æ–‡ä»¶å¤¹
const playgroundDir = path.resolve(__dirname, &#39;./playground/&#39;)

function createProjectWithFeatureFlags(flags) {
  // flagsä¼šä»¥æ•°ç»„çš„å½¢å¼ä¼ å…¥ï¼Œå¦‚æœå‡ºç°å¤šä¸ªå‚æ•°æ—¶ï¼Œç”¨-åˆ†å‰²
  const projectName = flags.join(&#39;-&#39;)
  console.log(`Creating project ${projectName}`)
  // è°ƒç”¨å­è¿›ç¨‹
  // è¿™éƒ¨åˆ†ä¼šç”Ÿæˆä¸€ä¸ªç±»ä¼¼äº node ./index.js --typescript --forceçš„å‘½ä»¤
  // ä¸»è¦å°±æ˜¯è°ƒç”¨index.jsä¸­çš„initæ–¹æ³•ç”Ÿæˆæ¨¡æ¿
  const { status } = spawnSync(
    &#39;node&#39;,
    [bin, projectName, ...flags.map((flag) =&gt; `--${flag}`), &#39;--force&#39;],
    {
      cwd: playgroundDir,
      stdio: [&#39;pipe&#39;, &#39;pipe&#39;, &#39;inherit&#39;]
    }
  )

  if (status !== 0) {
    process.exit(status)
  }
}
</code></pre></div><p>è¿™é‡Œä¸»è¦çš„çµé­‚å°±æ˜¯è°ƒèµ·å­è¿›ç¨‹ï¼Œæ‰§è¡Œæ–‡ä»¶ç”Ÿæˆé¡¹ç›®æ¨¡æ¿</p><p>æ¥ç€çœ‹çœ‹å…·ä½“æ˜¯æ€ä¹ˆç”Ÿæˆæ¨¡æ¿çš„</p><h4 id="_3-2-index-js"><a class="header-anchor" href="#_3-2-index-js" aria-hidden="true">#</a> 3.2 index.js</h4><p>è¿™éƒ¨åˆ†ä¸»è¦åšäº†ä»¥ä¸‹å‡ ä»¶äº‹ï¼š</p><ul><li>æ”¯æŒfeature Flagsç›´æ¥ç”Ÿæˆæ¨¡æ¿</li><li>è°ƒç”¨<code>prompts</code>è¿›è¡Œäº¤äº’å¼é…ç½®</li></ul><!----><ul><li>æ ¹æ®é…ç½®è°ƒç”¨render()æ¸²æŸ“æ¨¡æ¿</li><li>æ ¹æ®é…ç½®ç”Ÿæˆä¸åŒREADME</li></ul><h5 id="_3-2-1-äº¤äº’å¼"><a class="header-anchor" href="#_3-2-1-äº¤äº’å¼" aria-hidden="true">#</a> 3.2.1 äº¤äº’å¼</h5><p>é¦–å…ˆåœ¨scriptä¸­æ·»åŠ ä¸€è¡Œ<code>&quot;dev&quot;:&quot;node index.js&quot;</code>è¿è¡Œè°ƒè¯•ï¼Œå¼€å§‹æˆ‘ä»¬çš„debug</p><p>æœ€å…ˆè¿›å…¥çš„ä¼šæ˜¯ä¸€æ®µäº¤äº’å¼é…ç½®ï¼Œè¿™éƒ¨åˆ†ä»£ç å°†åšçœç•¥ï¼Œä¿ç•™ä¸€äº›è°ƒç”¨äº†å·¥å…·æ–¹æ³•çš„é…ç½®</p><div class="language-"><pre><code>let result = {}

  try {
    result = await prompts(
      [
        {
          name: &#39;shouldOverwrite&#39;,
          // è¿™é‡Œåˆ¤æ–­äº†ä¸€æ¬¡æ”¹åç§°æ˜¯å¦å¯å†™å…¥
          type: () =&gt; (canSafelyOverwrite(targetDir) || forceOverwrite ? null : &#39;confirm&#39;),
          message: () =&gt; {
            const dirForPrompt =
              targetDir === &#39;.&#39; ? &#39;Current directory&#39; : `Target directory &quot;${targetDir}&quot;`

            return `${dirForPrompt} is not empty. Remove existing files and continue?`
          }
        },
        {
          name: &#39;overwriteChecker&#39;,
          type: (prev, values = {}) =&gt; {
            if (values.shouldOverwrite === false) {
              throw new Error(red(&#39;âœ–&#39;) + &#39; Operation cancelled&#39;)
            }
            return null
          }
        },
        {
          name: &#39;packageName&#39;,
          // è¿™é‡Œåˆ¤æ–­äº†ä¸€æ¬¡å½“å‰åŒ…åç§°æ˜¯å¦åˆæ³•
          type: () =&gt; (isValidPackageName(targetDir) ? null : &#39;text&#39;),
          message: &#39;Package name:&#39;,
          // è¿™é‡Œè°ƒç”¨äº†è½¬æ¢åŒ…åå·¥å…·
          initial: () =&gt; toValidPackageName(targetDir),
          validate: (dir) =&gt; isValidPackageName(dir) || &#39;Invalid package.json name&#39;
        },
      ],
    )
  } catch (cancelled) {
    console.log(cancelled.message)
    process.exit(1)
  }
</code></pre></div><p>è¿™ä¸‰ä¸ªå·¥å…·å‡½æ•°ä¹Ÿæ¯”è¾ƒç®€å•ï¼Œé€šè¿‡æ­£åˆ™æˆ–nodeæ–¹æ³•ï¼Œè¿›è¡Œç®€å•çš„åˆ¤æ–­</p><div class="language-"><pre><code>// ä½¿ç”¨æ­£åˆ™åˆ¤æ–­å½“å‰åŒ…åæ˜¯å¦åˆæ³•ï¼Œæ²¡æœ‰é‡‡ç”¨validate-npm-package-nameï¼ˆç¬¬ä¸ƒæœŸæ£€æµ‹åŒ…åæ˜¯å¦åˆæ³•çš„å·¥å…·ï¼‰ï¼Œè‡ªå·±å®ç°äº†æ£€æµ‹åŠŸèƒ½
function isValidPackageName(projectName) {
  return /^(?:@[a-z0-9-*~][a-z0-9-*._~]*/)?[a-z0-9-~][a-z0-9-._~]*$/.test(projectName)
}

// å¯¹ä¼ å…¥çš„åŒ…åç§°è¿›è¡Œè½¬å†™
function toValidPackageName(projectName) {
  return projectName
    .trim()
    .toLowerCase()
    .replace(/\s+/g, &#39;-&#39;)
    .replace(/^[._]/, &#39;&#39;)
    .replace(/[^a-z0-9-~]+/g, &#39;-&#39;)
}

// ä½¿ç”¨nodeçš„å†…ç½®æ–¹æ³•ï¼Œåˆ¤æ–­æœ¬åœ°æ˜¯å¦å­˜åœ¨è¯¥åç§°çš„æ–‡ä»¶å¤¹ï¼Œä»¥åŠè¯¥æ–‡ä»¶å¤¹ä¸‹æ˜¯å¦æœ‰æ–‡ä»¶
function canSafelyOverwrite(dir) {
  return !fs.existsSync(dir) || fs.readdirSync(dir).length === 0
}
</code></pre></div><p>åœ¨æ‰§è¡Œå®Œæ‰€æœ‰çš„äº¤äº’é…ç½®åï¼Œä¼šåœ¨æ–‡ä»¶å†…éƒ¨<code>result</code>å±æ€§ä¸­è®°å½•æœ€ç»ˆçš„é…ç½®ç»“æœï¼š</p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/2b95f5d4163047e7804616c7a7a411f0~tplv-k3u1fbpfcp-zoom-1.image" alt=""></p><h5 id="_3-2-2ç”Ÿæˆæ¨¡æ¿"><a class="header-anchor" href="#_3-2-2ç”Ÿæˆæ¨¡æ¿" aria-hidden="true">#</a> 3.2.2ç”Ÿæˆæ¨¡æ¿</h5><p>ç”Ÿæˆå®Œæ‰€æœ‰é…ç½®åï¼Œä¼šæ ¹æ®é…ç½®è¿›è¡Œæ¨¡æ¿ç”Ÿæˆï¼Œå…·ä½“ç”Ÿæˆé¡ºåºå¦‚ä¸‹ï¼š</p><ul><li><p>ç”ŸæˆbaseåŸºç¡€æ¨¡æ¿</p></li><li><p>æ ¹æ®ä¸åŒé…ç½®éœ€æ±‚ï¼Œç»§ç»­æ·»åŠ åˆå¹¶æ¨¡æ¿</p></li><li><p>å¦‚æœéœ€è¦typeScriptï¼Œå°†æ‰€æœ‰.jsæ–‡ä»¶æ”¹æˆ.tsï¼Œå¹¶å°†jsconfig.jsonæ”¹æˆtsconfig.json</p></li><li><p>å¦‚æœä¸éœ€è¦æµ‹è¯•ï¼Œå°±æŠŠæµ‹è¯•ç›¸å…³æ–‡ä»¶åˆ é™¤</p></li><li><p>ç”ŸæˆREADMEæ–‡æ¡£</p></li></ul><p>ç¬¬ä¸€æ­¥ï¼ç”Ÿæˆæ¨¡æ¿</p><div class="language-"><pre><code>import renderTemplate from &#39;./utils/renderTemplate.js&#39;

// è®¾ç½®æ¨¡æ¿æ–‡ä»¶åœ°å€
const templateRoot = path.resolve(__dirname, &#39;template&#39;)

// ç”Ÿæˆæ¨¡æ¿ä¸»å‡½æ•°
const render = function render(templateName) {
  // å…·ä½“è¦ç”Ÿæˆçš„æ¨¡æ¿ç›®å½•ä¸‹çš„å­ç›®å½•
  const templateDir = path.resolve(templateRoot, templateName)
  // ä¼ å…¥å­ç›®å½•å’Œé¡¹ç›®çš„åœ°å€
  renderTemplate(templateDir, root)
}

// Render base template
render(&#39;base&#39;)
</code></pre></div><p>æ¥ç€çœ‹çœ‹å…·ä½“ç”Ÿæˆæ¨¡æ¿çš„æµç¨‹ï¼ŒåŒæ ·ä¹Ÿåˆ†æˆä¸‰éƒ¨åˆ†ï¼š</p><ul><li>é€’å½’copyæ‰€æœ‰çš„æ¨¡æ¿æ–‡ä»¶è¿›é¡¹ç›®ä¸­</li><li>å¦‚æœæ–‡ä»¶ä¸­å­˜åœ¨package.jsonï¼Œè¿›è¡Œå¯¹è±¡åˆå¹¶</li></ul><!----><ul><li>å°†ä»¥<code>_</code>å¼€å¤´çš„æ–‡ä»¶æ›¿æ¢æˆ<code>.</code>å¼€å¤´</li></ul><p>ç¬¬ä¸€éƒ¨åˆ†ï¼šå¤„ç†æ–‡ä»¶å¤¹</p><div class="language-"><pre><code>const stats = fs.statSync(src)
// å¦‚æœä¼ å…¥çš„srcæ˜¯æ–‡ä»¶å¤¹ï¼Œå°±é€’å½’è°ƒç”¨renderTemplateå¤„ç†æ–‡ä»¶å¤¹ä¸‹çš„æ¯ä¸€ä¸ªæ–‡ä»¶
if (stats.isDirectory()) {
  // if it&#39;s a directory, render its subdirectories and files recursively
  fs.mkdirSync(dest, { recursive: true })
  for (const file of fs.readdirSync(src)) {
    renderTemplate(path.resolve(src, file), path.resolve(dest, file))
  }
  return
}
</code></pre></div><p>ç¬¬äºŒéƒ¨åˆ†ï¼šå¤„ç†<code>package.json</code>æ–‡ä»¶ï¼š</p><div class="language-"><pre><code>import deepMerge from &#39;./deepMerge.js&#39;
import sortDependencies from &#39;./sortDependencies.js&#39;
const filename = path.basename(src)

// å¦‚æœæ–‡ä»¶åç§°ä¸ºpackage.jsonä¸”è¯¥æ–‡ä»¶å·²ç»å­˜åœ¨
if (filename === &#39;package.json&#39; &amp;&amp; fs.existsSync(dest)) {
  // å­˜æ”¾éœ€è¦æ“ä½œçš„æ–‡ä»¶
  const existing = JSON.parse(fs.readFileSync(dest))
  // å­˜æ”¾éœ€è¦æ‹·è´çš„æ–‡ä»¶
  const newPackage = JSON.parse(fs.readFileSync(src))
  // é‡ç‚¹ï¼ï¼šè°ƒç”¨äº†ä¸¤ä¸ªå‡½æ•°ï¼ŒdeepMergeç”¨äºå¤„ç†ä¸¤ä¸ªjsonçš„åˆå¹¶ï¼ŒsortDependenciesç”¨äºæ’åº
  const pkg = sortDependencies(deepMerge(existing, newPackage))
  fs.writeFileSync(dest, JSON.stringify(pkg, null, 2) + &#39;\n&#39;)
  return
}
</code></pre></div><p>å¤„ç†æ–‡ä»¶è¿‡ç¨‹ä¸­ä½¿ç”¨åˆ°ä¸¤ä¸ªå‡½æ•°ï¼š<code>deepMerge</code>ã€<code>sortDependencies</code>ï¼Œåˆ†åˆ«ç”¨äºå¤„ç†åˆå¹¶å’Œæ’åº</p><p>ç»§ç»­æ·±å…¥çœ‹<code>deepMerge</code>ï¼Œè¿™éƒ¨åˆ†ä¸»è¦æ˜¯å¯¹ å¯¹è±¡å’Œæ•°ç»„çš„å¤„ç†ï¼š</p><ul><li>å¤„ç†å¯¹è±¡æ—¶ï¼Œé€šè¿‡é€’å½’èµ‹å€¼è¿›è¡Œå¤„ç†</li><li>å¤„ç†æ•°ç»„æ—¶ï¼Œé€šè¿‡è§£æ„åˆå¹¶è¿›è¡Œå¤„ç†</li></ul><div class="language-"><pre><code>const isObject = (val) =&gt; val &amp;&amp; typeof val === &#39;object&#39;
const mergeArrayWithDedupe = (a, b) =&gt; Array.from(new Set([...a, ...b]))

/**
 * Recursively merge the content of the new object to the existing one
 * @param {Object} target the existing object
 * @param {Object} obj the new object
 */
function deepMerge(target, obj) {
  // å¾ªç¯ä¼ å…¥çš„templateä¸­çš„æ¨¡æ¿
  for (const key of Object.keys(obj)) {
    const oldVal = target[key]
    const newVal = obj[key]
		//å¦‚æœå‚æ•°çš„å†…å®¹æ˜¯æ•°ç»„
    if (Array.isArray(oldVal) &amp;&amp; Array.isArray(newVal)) {
      // ä½¿ç”¨è§£æ„è¿›è¡Œåˆå¹¶
      target[key] = mergeArrayWithDedupe(oldVal, newVal)
    } else if (isObject(oldVal) &amp;&amp; isObject(newVal)) {
      // å¦‚æœå‚æ•°å†…å®¹æ˜¯å¯¹è±¡ï¼Œå°±ç»§ç»­é€’å½’å¤„ç†ï¼Œç›´åˆ°æ˜¯å†…å®¹
      target[key] = deepMerge(oldVal, newVal)
    } else {
      // ç›´æ¥ä¸ºå†…å®¹æ—¶ï¼Œç›´æ¥èµ‹å€¼
      target[key] = newVal
    }
  }

  return target
}
</code></pre></div><p>åˆå¹¶åç»§ç»­åšæ’åºçš„å¤„ç†ï¼Œè¿™æ—¶ä¼šè¿›å…¥åˆ°<code>sortDependencies</code>å‡½æ•°ä¸­</p><div class="language-"><pre><code>export default function sortDependencies(packageJson) {
  const sorted = {}
	// ä¾ç…§æ•°ç»„ä¸­å…ƒç´ çš„é¡ºåºï¼Œè¿›è¡Œéå†æ’åº
  const depTypes = [&#39;dependencies&#39;, &#39;devDependencies&#39;, &#39;peerDependencies&#39;, &#39;optionalDependencies&#39;]

  for (const depType of depTypes) {
    if (packageJson[depType]) {
      sorted[depType] = {}

      Object.keys(packageJson[depType])
        .sort()
        .forEach((name) =&gt; {
          sorted[depType][name] = packageJson[depType][name]
        })
    }
  }

  return {
    ...packageJson,
    ...sorted
  }
}
</code></pre></div><p>ç¬¬ä¸‰éƒ¨åˆ†ï¼Œä¿®æ”¹æ–‡ä»¶å</p><p>é¡¹ç›®ä¸­ä»¥<code>.</code>å¼€å¤´çš„æ–‡ä»¶éƒ½æ˜¯ä¸€äº›é…ç½®æ–‡ä»¶ï¼Œè€Œå¦‚æœç›´æ¥åœ¨æ¨¡æ¿ä¸­å­˜æ”¾è¿™äº›æ–‡ä»¶æ—¶ï¼Œå¯èƒ½ä¼šé€ æˆç¼–è¯‘å™¨è¯†åˆ«çš„ä¸€äº›å½±å“ï¼Œæ‰€ä»¥åœ¨æ¨¡æ¿ä¸­ï¼Œéƒ½ä»¥<code>_</code>å¼€å¤´å­˜æ”¾æ–‡ä»¶ï¼Œåœ¨ç”Ÿæˆæ¨¡æ¿æ–‡ä»¶æ—¶å†è¿›è¡Œæ”¹å</p><p>è¿™é‡Œæ¯”è¾ƒç®€å•ï¼Œå°±æ˜¯ä¸€ä¸ªnode.pathçš„è°ƒç”¨</p><div class="language-"><pre><code>if (filename.startsWith(&#39;_&#39;)) {
  // rename `_file` to `.file`
  dest = path.resolve(path.dirname(dest), filename.replace(/^_/, &#39;.&#39;))
}
</code></pre></div><p>è‡³æ­¤ï¼Œä¸€ä¸ªæ¨¡æ¿å·²ç»å®Œå…¨ç”Ÿæˆï¼</p><p>è®©æˆ‘ä»¬è¿›å…¥ç®€å•çš„ç¬¬äºŒæ­¥ï¼šæ ¹æ®è‡ªå®šä¹‰é…ç½®ç»§ç»­ç”Ÿæˆæ¨¡æ¿</p><p>è¿™éƒ¨åˆ†æ¯”è¾ƒç®€å•ï¼Œä»ä¹‹å‰çš„é…ç½®ä¿¡æ¯ä¸­ï¼Œç”Ÿæˆè°ƒç”¨ä¸åŒè·¯å¾„ä¸‹çš„æ–‡ä»¶ï¼Œç»§ç»­ç”Ÿæˆæ¨¡æ¿</p><div class="language-"><pre><code>  // Add configs.
  if (needsJsx) {
    render(&#39;config/jsx&#39;)
  }
  if (needsRouter) {
    render(&#39;config/router&#39;)
  }
  if (needsVuex) {
    render(&#39;config/vuex&#39;)
  }
  if (needsTests) {
    render(&#39;config/cypress&#39;)
  }
  if (needsTypeScript) {
    render(&#39;config/typescript&#39;)
  }

  // Render code template.
  // prettier-ignore
  const codeTemplate =
    (needsTypeScript ? &#39;typescript-&#39; : &#39;&#39;) +
    (needsRouter ? &#39;router&#39; : &#39;default&#39;)
  render(`code/${codeTemplate}`)

  // Render entry file (main.js/ts).
  if (needsVuex &amp;&amp; needsRouter) {
    render(&#39;entry/vuex-and-router&#39;)
  } else if (needsVuex) {
    render(&#39;entry/vuex&#39;)
  } else if (needsRouter) {
    render(&#39;entry/router&#39;)
  } else {
    render(&#39;entry/default&#39;)
  }
</code></pre></div><p>ç»§ç»­è¿›å…¥ç¬¬ä¸‰æ­¥ï¼šä½¿ç”¨<code>typeScript</code></p><p>è¿™éƒ¨åˆ†æ¯”è¾ƒç®€å•ï¼Œé€’å½’éå†æ‰€æœ‰åç¼€ä¸º<code>.js</code>çš„æ–‡ä»¶ï¼Œæ›¿æ¢æˆ<code>.ts</code>ï¼Œä»¥åŠå°†jsconfig.jsonè½¬æ¢æˆtsconfig.jsonï¼ˆç®€å•ç²—æš´ï¼‰ï¼Œåœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­è°ƒç”¨äº†<code>preOrderDirectoryTraverse</code>æ–¹æ³•ï¼Œæˆ‘ä»¬é‡ç‚¹ç»†çœ‹è¿™éƒ¨åˆ†æ–¹æ³•</p><div class="language-"><pre><code>if (needsTypeScript) {
  // rename all `.js` files to `.ts`
  // rename jsconfig.json to tsconfig.json
  preOrderDirectoryTraverse(
    root,
    () =&gt; {},
    (filepath) =&gt; {
      // å¦‚æœåç¼€ä¸º.js
      if (filepath.endsWith(&#39;.js&#39;)) {
        // è¿›è¡Œæ›¿æ¢
        fs.renameSync(filepath, filepath.replace(/.js$/, &#39;.ts&#39;))
        // åŒæ—¶å¦‚æœä¸ºjsconfig.json
      } else if (path.basename(filepath) === &#39;jsconfig.json&#39;) {
        // ä¹Ÿè¿›è¡Œæ›¿æ¢
        fs.renameSync(filepath, filepath.replace(/jsconfig.json$/, &#39;tsconfig.json&#39;))
      }
    }
  )

  // Rename entry in `index.html`
  const indexHtmlPath = path.resolve(root, &#39;index.html&#39;)
  const indexHtmlContent = fs.readFileSync(indexHtmlPath, &#39;utf8&#39;)
  fs.writeFileSync(indexHtmlPath, indexHtmlContent.replace(&#39;src/main.js&#39;, &#39;src/main.ts&#39;))
}
</code></pre></div><p>ç»§ç»­è¿›å…¥<code>preOrderDirectoryTraverse</code></p><div class="language-"><pre><code>// è¿™é‡Œä¸»è¦æ˜¯åšæ–‡ä»¶å¤¹å’Œæ–‡ä»¶çš„é€’å½’
export function preOrderDirectoryTraverse(dir, dirCallback, fileCallback) {
  // é¦–å…ˆè¯»å–è¯¥è·¯å¾„ä¸‹æ‰€æœ‰æ–‡ä»¶
  for (const filename of fs.readdirSync(dir)) {
    const fullpath = path.resolve(dir, filename)
    // å¦‚æœæ˜¯ä¸€ä¸ªæ–‡ä»¶å¤¹
    if (fs.lstatSync(fullpath).isDirectory()) {
      // æ‰§è¡Œæ–‡ä»¶å¤¹çš„å›è°ƒ
      dirCallback(fullpath)
      // in case the dirCallback removes the directory entirely
      // å¦‚æœæ–‡ä»¶å¤¹æ²¡æœ‰è¢«åˆ é™¤ï¼Œè¿˜å­˜åœ¨
      if (fs.existsSync(fullpath)) {
        // ç»§ç»­é€’å½’é‡Œé¢çš„æ–‡ä»¶
        preOrderDirectoryTraverse(fullpath, dirCallback, fileCallback)
      }
      continue
    }
    // æ‰§è¡Œæ–‡ä»¶çš„å›è°ƒ
    fileCallback(fullpath)
  }
}
</code></pre></div><p>è‡³æ­¤ï¼Œtsçš„è½¬åŒ–ä¹Ÿå·²ç»å®Œæˆ~</p><p>è¿›å…¥ç¬¬å››æ­¥ï¼šåˆ é™¤æµ‹è¯•ç›¸å…³æ–‡ä»¶</p><p>è°ƒç”¨<code>fs.rmdirSync</code>åˆ é™¤æ–‡ä»¶å¤¹æ—¶ï¼Œåªèƒ½åˆ é™¤ç©ºæ–‡ä»¶å¤¹ï¼Œæ‰€ä»¥éœ€è¦é€šè¿‡éå†æ–‡ä»¶å¤¹ä»¥åŠæ–‡ä»¶å¤¹å†…æ‰€æœ‰çš„æ–‡ä»¶ï¼Œå…ˆåˆ é™¤æ–‡ä»¶ï¼Œå†åˆ é™¤æ–‡ä»¶å¤¹</p><p>è¿™é‡ŒåŒæ ·è°ƒç”¨äº†<code>preOrderDirectoryTraverse</code>æ–¹æ³•ï¼Œ</p><p>å¹¶ä¸”åœ¨æ–‡ä»¶å¤¹å›è°ƒå‡½æ•°ä¸­è°ƒç”¨äº†<code>emptyDir</code>æ–¹æ³•</p><div class="language-"><pre><code>if (!needsTests) {
  preOrderDirectoryTraverse(
    root,
    (dirpath) =&gt; {
      const dirname = path.basename(dirpath)
			// å¦‚æœæ–‡ä»¶å¤¹ä¸ºæµ‹è¯•æ–‡ä»¶å¤¹
      if (dirname === &#39;cypress&#39; || dirname === &#39;__tests__&#39;) {
        // è°ƒç”¨æ–¹æ³•è¿›è¡Œåˆ é™¤
        emptyDir(dirpath)
        fs.rmdirSync(dirpath)
      }
    },
    () =&gt; {}
  )
}


function emptyDir(dir) {
  // ç»§ç»­æ–‡ä»¶å¤¹é€’å½’
  postOrderDirectoryTraverse(
    dir,
    (dir) =&gt; fs.rmdirSync(dir),
    (file) =&gt; fs.unlinkSync(file)
  )
}

export function postOrderDirectoryTraverse(dir, dirCallback, fileCallback) {
  for (const filename of fs.readdirSync(dir)) {
    const fullpath = path.resolve(dir, filename)
    // å¦‚æœæ˜¯æ–‡ä»¶å¤¹ï¼Œå°±ç»§ç»­é€’å½’
    if (fs.lstatSync(fullpath).isDirectory()) {
      postOrderDirectoryTraverse(fullpath, dirCallback, fileCallback)
      dirCallback(fullpath)
      continue
    }
    // å¦‚æœæ˜¯æ–‡ä»¶ï¼Œè°ƒç”¨æ–‡ä»¶å›è°ƒå‡½æ•°
    fileCallback(fullpath)
  }
}
</code></pre></div><p>æœ€åç¬¬äº”æ­¥ï¼šç”ŸæˆREADME</p><div class="language-"><pre><code>fs.writeFileSync(
  path.resolve(root, &#39;README.md&#39;),
  generateReadme({
    projectName: result.projectName || defaultProjectName,
    packageManager,
    needsTypeScript,
    needsTests
  })
)
</code></pre></div><h3 id="_4-æ€»ç»“"><a class="header-anchor" href="#_4-æ€»ç»“" aria-hidden="true">#</a> 4. æ€»ç»“</h3><p>è¿™æ¬¡çš„cliæºç é˜…è¯»èƒ½æ„ŸçŸ¥åˆ°è‡ªå·±çš„çŸ¥è¯†çŸ­æ¿ï¼Œåœ¨æ‰§è¡Œæµç¨‹èƒ½å¤§æ¦‚è¯»æ‡‚å¤–ï¼Œå¯¹äºå¾ˆå¤šå°è£…æ–¹æ³•ä¸­æ¶‰åŠåˆ°çš„ç®—æ³•ã€nodeæŒ‡ä»¤ï¼Œé˜…è¯»èµ·æ¥è¿˜æ˜¯æ¯”è¾ƒåƒåŠ›ï¼Œéœ€è¦åå¤ä½¿ç”¨debugå’ŒæŸ¥é˜…nodeæ–‡æ¡£è¿›è¡Œç†è§£ã€‚</p><p>ç»“åˆç¬¬6æœŸï¼Œå¯ä»¥å‘ç°åœ¨åˆ¶ä½œè„šæ‰‹æ¶ã€å¼€æºåº“æ—¶ï¼Œæœ‰å¾ˆå¤šå·¥å…·åº“å¯ä»¥ç›´æ¥ä½¿ç”¨ï¼ŒåŠ å¿«å¼€å‘é€Ÿåº¦ï¼Œä¾‹å¦‚<code>prompts</code>äº¤äº’å¼ç”Ÿæˆé…ç½®ï¼Œå°±æ˜¯ä¸€ä¸ªå¾ˆä¸é”™çš„åº“</p><p>åç»­è¿˜ä¼šåå¤é˜…è¯»è¿™ä¸ªåº“çš„æºç ï¼Œå­¦ä¹ å’Œå€Ÿé‰´åˆ¶ä½œcliçš„æµç¨‹ï¼Œå¼€å‘ä¸€ä¸ªåœ¨å·¥ä½œå›¢é˜Ÿå†…éƒ¨å¯ä»¥æ–¹ä¾¿å¿«é€Ÿæ‹‰å–æ¨¡æ¿ä»£ç åº“çš„cliï¼Œå¹¶æ€»ç»“ä¸€ç¯‡åˆ¶ä½œcliå·¥å…·çš„æ–‡ç« </p></div><div class="links-wrapper"><div class="prev-link"><!----></div><div class="next-link"><!----></div></div><div><footer class="page-edit"><!--[--><a href="https://juejin.cn/user/465848663286712"><img class="imgIcon" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABfVBMVEX///8Ad/8AgP8AgP8AgP8Aff8AgP8Af/8AgP8AVf8Af/8Af/8AgP8AgP8Af/8Afv8AAP8Afv8Afv8Aef8AgP8AdP8Afv8AgP8AgP8Acf8Ae/8AgP8Af/8AgP8Af/8Af/8AfP8Afv8AgP8Af/8Af/8Afv8Afv8AgP8Afv8AgP8Af/8Af/8AgP8AgP8Afv8AgP8Af/8AgP8AgP8AgP8Ae/8Afv8Af/8AgP8Af/8AgP8Af/8Af/8Aff8Af/8Abf8AgP8Af/8AgP8Af/8Af/8Afv8AgP8AgP8Afv8Afv8AgP8Af/8Aff8AgP8Afv8AgP8Aff8AgP8AfP8AgP8Ae/8AgP8Af/8AgP8AgP8AgP8Afv8AgP8AgP8AgP8Afv8AgP8AgP8AgP8AgP8AgP8Af/8AgP8Af/8Af/8Aev8Af/8AgP8Aff8Afv8AgP8AgP8AgP8Af/8AgP8Af/8Af/8AgP8Afv8AgP8AgP8AgP8AgP8Af/8AeP8Af/8Af/8Af//////rzEHnAAAAfXRSTlMAD7CCAivatxIDx5EMrP19AXdLEwgLR+6iCR/M0yLRzyFF7JupSXn8cw6v60Q0QeqzKtgeG237HMne850/6Qeq7QaZ+WdydHtj+OM3qENCMRYl1B3K2U7wnlWE/mhlirjkODa9FN/BF7/iNV/2kASNZpX1Wlf03C4stRGxgUPclqoAAAABYktHRACIBR1IAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gEaBzgZ4yeM3AAAAT9JREFUOMvNUldbwkAQvCAqsSBoABE7asSOBRUVVBQNNuy9996789+9cMFAMHnVebmdm+/bmdtbQv4dOFOW2UjPzgFyLfo6nweKfIMOBYWwFtmMPGz2Yj2pJI0JDq3udJW6VVbmKa9I192VQFV1ktXUAl5NB0cd4KpnORqsEO2ZIRpF9gJfE9Dckqq0KuZt7UAH5+8EPF3spjsRpCeQNO/tA/qDwIDA+OCQbBoKA8NOdjMySgcZGVM6jwcgRuUiSs0nlPFNSrEpJfU0jTLD6llqbvKxei7OzvkFNQohi0vAsj81+MoqsCaoPOQFgus/1LyxichW+hS2JWCHZ7VlF9jb187pIAYcHiViHAMnp5mTjJ8B5xeEXF4B1ze/fTh/C0h398DDI9HB07O8ci+vRBdvdGnfP4gBuM8vw7X/G3wDmFhFZEdxzjMAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTgtMDEtMjZUMDc6NTY6MjUrMDE6MDA67pVWAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE4LTAxLTI2VDA3OjU2OjI1KzAxOjAwS7Mt6gAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAWdEVYdFRpdGxlAGp1ZWppbl9sb2dvIGNvcHlxapmKAAAAV3pUWHRSYXcgcHJvZmlsZSB0eXBlIGlwdGMAAHic4/IMCHFWKCjKT8vMSeVSAAMjCy5jCxMjE0uTFAMTIESANMNkAyOzVCDL2NTIxMzEHMQHy4BIoEouAOoXEXTyQjWVAAAAAElFTkSuQmCC"></a><a href="https://www.yuque.com/shouhu-pelkv"><img class="imgIcon" src="/blog/_assets/yuque.2a316201.png"></a><!--]--></footer><p class="platform"> ä»¥ä¸Šçš†ä¸º <a href="javascript:;">ç˜¦è™</a> æ–‡ç« å‘å¸ƒå¹³å° </p><p class="platform"> Copyright Â© 2020-2021 <a href="https://github.com/gelxgx">@Gelxgx</a></p></div><!--[--><!--]--></div><!-- åªæƒ³ç‚¹å‡»èƒŒæ™¯æ‰å…³é—­ è¯·ä½¿ç”¨ .self ä¿®é¥°ç¬¦ --><div style="display:none;" class="imgBox"><img src=""></div><!--]--></main><div class="theme-select" data-v-1eb0b654><ul data-v-1eb0b654><li class="active" data-v-1eb0b654>â˜€ï¸</li><li class="" data-v-1eb0b654>ğŸŒ‘</li></ul></div></div><!----><!--]--></div>
    <script>__VP_HASH_MAP__ = JSON.parse("{\"README.md\":\"56ed425b\",\"index.md\":\"1783787d\",\"more_Friendship.md\":\"0d404086\",\"more_docs.md\":\"c4c7f0eb\",\"more_index.md\":\"350c9b6f\",\"more_tags.md\":\"36c4af96\",\"docs_HTTP_HTTP.md\":\"a018e2b2\",\"docs_React_react.md\":\"3700d50c\",\"docs_TypeScript_ts-class-function.md\":\"47de5c14\",\"docs_TypeScript_ts-type-interface.md\":\"4b859e67\",\"docs_arithmetic_arithmetic.md\":\"c0bf1668\",\"docs_soundCode_co.md\":\"17fa0c9b\",\"docs_soundCode_creat-vue.md\":\"782b5c9a\",\"docs_soundCode_koa-compose.md\":\"f6f000ab\",\"docs_soundCode_mitt-tiny-emitter.md\":\"764ec47d\",\"docs_soundCode_update-notifier.md\":\"342ac959\",\"docs_soundCode_validate-npm-package-name.md\":\"b739095c\",\"docs_soundCode_vite.md\":\"947ae370\",\"docs_soundCode_vue20tools.md\":\"8cbc77c4\",\"docs_soundCode_vueDevTools.md\":\"ec3412ef\"}")</script>
    <script type="module" async src="/blog/_assets/app.9e239910.js"></script>
  </body>
</html>